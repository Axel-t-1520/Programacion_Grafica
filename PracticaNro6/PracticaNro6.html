<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background: #e0e0e0;
      }
      #container {
        display: flex;
        height: 100vh;
      }
      #opciones {
        width: 150px;
        background-color: #2c2c2c;
        color: white;
        padding: 10px;
        overflow-y: auto;
        box-shadow: 2px 0 10px rgba(0,0,0,0.3);
      }
      #canvas-holder {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        background: black
      }
      canvas {
        border: 2px solid #fff;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      }

      .nav-controls {
        margin: 15px 0;
      }
      .nav-grid {
        display: grid;
        grid-template-columns: repeat(3, 40px);
        gap: 5px;
        justify-content: center;
      }
      .nav-btn {
        width: 40px;
        height: 40px;
        background: #444;
        border: 2px solid #666;
        border-radius: 8px;
        color: white;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
      }
      .nav-btn:hover {
        background: #555;
        border-color: #888;
        transform: scale(1.05);
      }
      .nav-btn:active {
        transform: scale(0.95);
      }
      .zoom-controls {
        display: grid;
        grid-template-columns: repeat(2, 60px);
        gap: 5px;
        justify-content: center;
        margin-top: 10px;
      }
      .menu-icon {
        width: 50px;
        height: 50px;
        margin: 5px auto;
        background: #444;
        border: 2px solid #666;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 24px;
        transition: all 0.3s;
      }
      .menu-icon:hover {
        background: #555;
        border-color: #888;
        transform: scale(1.05);
      }
      .menu-icon.active {
        background: #4CAF50;
        border-color: #4CAF50;
      }
      .section-divider {
        height: 1px;
        background: #555;
        margin: 15px 0;
      }
      .color-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin: 10px 0;
      }
      .color-btn {
        width: 100%;
        height: 40px;
        border: 2px solid #666;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .color-btn:hover {
        transform: scale(1.1);
        border-color: white;
      }
      .color-btn.active {
        border: 3px solid white;
        box-shadow: 0 0 10px rgba(255,255,255,0.5);
      }
      .section-title {
        font-size: 11px;
        text-align: center;
        margin: 10px 0 5px 0;
        color: #aaa;
        text-transform: uppercase;
      }
      select {
        width: 100%;
        padding: 5px;
        margin: 5px 0;
        background: #444;
        color: white;
        border: 1px solid #666;
        border-radius: 4px;
        font-size: 11px;
      }
      #info {
        font-size: 10px;
        color: #aaa;
        text-align: center;
        margin-top: 10px;
      }
    </style>
    <title>Visor 3D - WebGL 2.0</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  </head>
  <body>
    <div id="container">
      <div id="opciones">
        <div class="nav-controls">
          <div class="nav-grid">
            <div></div>
            <button class="nav-btn" id="upBtn">‚ñ≤</button>
            <div></div>
            <button class="nav-btn" id="leftBtn">‚óÑ</button>
            <button class="nav-btn" id="homeBtn">üè†</button>
            <button class="nav-btn" id="rightBtn">‚ñ∫</button>
            <div></div>
            <button class="nav-btn" id="downBtn">‚ñº</button>
            <div></div>
          </div>
          <div class="zoom-controls">
            <button class="nav-btn" id="zoomOutBtn">‚àí</button>
            <button class="nav-btn" id="zoomInBtn">+</button>
          </div>
        </div>

        <div class="section-divider"></div>

        <div class="section-title">Modelo</div>
        <select id="modelSelector">
          <option value="redFinal.json">Modelo 1</option>
          <option value="megatronFinal.json">Modelo 2</option>
          <option value="goblin2Final.json">Modelo 3</option>
        </select>

        <div class="section-divider"></div>

        <div class="section-title">Vista</div>
        <div class="menu-icon active" id="solidBtn" title="S√≥lido">‚¨õ</div>
        <div class="menu-icon" id="wireframeBtn" title="Malla">‚äû</div>

        <div class="section-divider"></div>

        <div class="section-title">Colores</div>
        <div class="color-grid">
          <div
            class="color-btn active"
            style="background: red;"
            data-mode="gradient"
            title="Gradiente"
          ></div>
          <div
            class="color-btn"
            style="background: orange;"
            data-color="#ff5722"
            title="Naranja"
          ></div>
          <div
            class="color-btn"
            style="background: #2196F3;"
            data-color="#2196F3"
            title="Azul"
          ></div>
          <div
            class="color-btn"
            style="background: #4CAF50;"
            data-color="#4CAF50"
            title="Verde"
          ></div>
          <div
            class="color-btn"
            style="background: #9C27B0;"
            data-color="#9C27B0"
            title="Morado"
          ></div>
          <div
            class="color-btn"
            style="background: #666;"
            data-color="#666666"
            title="Gris"
          ></div>
        </div>

        <div class="section-divider"></div>

        <div class="section-title">Animaci√≥n</div>
        <label
          style="display: flex; justify-content: center; align-items: center; color: white; font-size: 12px;"
        >
          <input
            type="checkbox"
            id="animacionCheckbox"
            style="margin-right: 8px; width: 18px; height: 18px; cursor: pointer;"
          />
          Rotar
        </label>

        <p id="info">Cargando...</p>
      </div>

      <div id="canvas-holder">
        <canvas
          id="webglcanvas"
          style="border: none;"
          width="1000"
          height="1000"
        ></canvas>
      </div>
    </div>

    <script id="vs" type="vertex">
      #version 300 es
      uniform mat4 uMatrizProyeccion;
      uniform mat4 uMatrizVista;
      uniform mat4 uMatrizModelo;
      layout(location = 0) in vec3 aVertices;
      layout(location = 1) in vec4 aColores;
      out vec4 vColores;
      out vec3 vPosicion;
      void main() {
        vec4 posModelo = uMatrizModelo * vec4(aVertices, 1.0);
        vPosicion = posModelo.xyz;
        vColores = aColores;
        gl_Position = uMatrizProyeccion * uMatrizVista * posModelo;
      }
    </script>

    <script id="fs" type="fragment">
      #version 300 es
      precision highp float;
      in vec4 vColores;
      in vec3 vPosicion;
      out vec4 color;
      void main() {
        // Iluminaci√≥n simple basada en posici√≥n
        vec3 lightDir = normalize(vec3(1.0, 1.0, 1.5));
        vec3 normal = normalize(cross(dFdx(vPosicion), dFdy(vPosicion)));

        // Luz ambiente + difusa
        float ambient = 0.4;
        float diffuse = max(dot(normal, lightDir), 0.0) * 0.6;
        float lighting = ambient + diffuse;

        color = vec4(vColores.rgb * lighting, vColores.a);
      }
    </script>

    <script>
      "use strict";

      let canvas;
      let programaID;
      let gl;
      let meshObject;
      let arcBall;

      let renderMode = "solid";
      let colorMode = "gradient";
      let solidColor = [0, 0, 0, 1.0];
      let wireframeColor = [0, 1, 0, 1.0];
      let currentFile = "redFinal.json";

      const PAN_SPEED = 0.3;
      const ZOOM_SPEED = 0.1;

      let uMatrizProyeccion, uMatrizVista, uMatrizModelo;
      let MatrizProyeccion = new Array(16);
      let MatrizVista = new Array(16);
      let MatrizModelo = new Array(16);
      let MatrizRotacion = new Array(16);
      let B = new Array(16);
      let boton_izq_presionado = false;
      let boton_der_presionado = false;
      let tx = 0, ty = 0, tz = 0;
      let sx = 1, sy = 1, sz = 1;

      // Rotaciones con botones de navegaci√≥n
      let rotX = 0;
      let rotY = 0;
      let rotZ = 0;

      // Animaci√≥n autom√°tica
      let animacionActiva = false;
      const VELOCIDAD_ROTACION = 0.35;

      function toRadians(g) { return g * Math.PI / 180; }

      function identidad(r) {
        r[0]=1;r[4]=0;r[8]=0;r[12]=0;
        r[1]=0;r[5]=1;r[9]=0;r[13]=0;
        r[2]=0;r[6]=0;r[10]=1;r[14]=0;
        r[3]=0;r[7]=0;r[11]=0;r[15]=1;
      }

      function traslacion(m,tx,ty,tz) {
        let r=[1,0,0,0,0,1,0,0,0,0,1,0,tx,ty,tz,1];
        multiplica(m,m,r);
      }

      function escalacion(m,sx,sy,sz) {
        let r=[sx,0,0,0,0,sy,0,0,0,0,sz,0,0,0,0,1];
        multiplica(m,m,r);
      }

      function rotacionX(m, theta) {
        let c = Math.cos(toRadians(theta));
        let s = Math.sin(toRadians(theta));
        let r = [1,0,0,0, 0,c,-s,0, 0,s,c,0, 0,0,0,1];
        multiplica(m, m, r);
      }

      function rotacionY(m, theta) {
        let c = Math.cos(toRadians(theta));
        let s = Math.sin(toRadians(theta));
        let r = [c,0,s,0, 0,1,0,0, -s,0,c,0, 0,0,0,1];
        multiplica(m, m, r);
      }

      function rotacionZ(m, theta) {
        let c = Math.cos(toRadians(theta));
        let s = Math.sin(toRadians(theta));
        let r = [c,-s,0,0, s,c,0,0, 0,0,1,0, 0,0,0,1];
        multiplica(m, m, r);
      }

      function ortho(r,l,ri,b,t,n,f) {
        r[0]=2/(ri-l);r[4]=0;r[8]=0;r[12]=-(ri+l)/(ri-l);
        r[1]=0;r[5]=2/(t-b);r[9]=0;r[13]=-(t+b)/(t-b);
        r[2]=0;r[6]=0;r[10]=-2/(f-n);r[14]=-(f+n)/(f-n);
        r[3]=0;r[7]=0;r[11]=0;r[15]=1;
      }

      function multiplica(c,a,b) {
        let r=new Array(16),i,j,k;
        for(i=0;i<4;i++)for(j=0;j<4;j++){
          let s=0;
          for(k=0;k<4;k++)s+=a[i+k*4]*b[k+j*4];
          r[i+j*4]=s;
        }
        for(i=0;i<16;i++)c[i]=r[i];
      }

      class Vector3 {
        constructor(x,y,z){this.x=x;this.y=y;this.z=z;}
        mas(v){return new Vector3(this.x+v.x,this.y+v.y,this.z+v.z);}
        menos(v){return new Vector3(this.x-v.x,this.y-v.y,this.z-v.z);}
        producto_vectorial(v){
          return new Vector3(
            this.y*v.z-this.z*v.y,
            this.z*v.x-this.x*v.z,
            this.x*v.y-this.y*v.x
          );
        }
        producto_escalar(v){return this.x*v.x+this.y*v.y+this.z*v.z;}
        longitud(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);}
        normaliza(){
          let l=this.longitud();
          if(l>0){this.x/=l;this.y/=l;this.z/=l;}
        }
      }

      class ArcBall {
        constructor(w,h){
          this.Epsilon=1e-5;
          this.U=new Vector3();
          this.V=new Vector3();
          this.ajusta(w,h);
        }
        ajusta(w,h){
          this.ajustaAncho=2/(w-1);
          this.ajustaAlto=2/(h-1);
        }
        obtieneVector(v,x,y){
          let t={x:(x*this.ajustaAncho)-1,y:1-(y*this.ajustaAlto)};
          let l2=t.x*t.x+t.y*t.y;
          if(l2>1){
            let n=1/Math.sqrt(l2);
            v.x=t.x*n;v.y=t.y*n;v.z=0;
          }else{
            v.x=t.x;v.y=t.y;v.z=Math.sqrt(1-l2);
          }
        }
        primerPunto(x,y){this.obtieneVector(this.U,x,y);}
        segundoPunto(x,y){
          let q=new Cuaternion();
          this.obtieneVector(this.V,x,y);
          let N=this.U.producto_vectorial(this.V);
          if(N.longitud()>this.Epsilon){
            q.x=N.x;q.y=N.y;q.z=N.z;
            q.w=this.U.producto_escalar(this.V);
          }else{q.x=q.y=q.z=q.w=0;}
          return q;
        }
      }

      class Cuaternion {
        constructor(w,x,y,z){this.w=w;this.x=x;this.y=y;this.z=z;}
        static rota2(a,q){
          let d=(q.x*q.x)+(q.y*q.y)+(q.z*q.z)+(q.w*q.w);
          let s=(d>0)?(2/d):0;
          a[0]=1-(q.y*q.y+q.z*q.z)*s;a[4]=(q.x*q.y-q.w*q.z)*s;a[8]=(q.x*q.z+q.w*q.y)*s;a[12]=0;
          a[1]=(q.x*q.y+q.w*q.z)*s;a[5]=1-(q.x*q.x+q.z*q.z)*s;a[9]=(q.y*q.z-q.w*q.x)*s;a[13]=0;
          a[2]=(q.x*q.z-q.w*q.y)*s;a[6]=(q.y*q.z+q.w*q.x)*s;a[10]=1-(q.x*q.x+q.y*q.y)*s;a[14]=0;
          a[3]=0;a[7]=0;a[11]=0;a[15]=1;
        }
      }

      class MeshFromJSON {
        constructor(gl,data){
          let verts=[],cols=[],idxT=[],idxL=[];
          let minY=Infinity,maxY=-Infinity;

          for(let i=0;i<data.vertices.length;i++){
            let y=data.vertices[i][1];
            if(y<minY)minY=y;
            if(y>maxY)maxY=y;
          }
          let rY=maxY-minY;

          for(let i=0;i<data.vertices.length;i++){
            let x=data.vertices[i][0],y=data.vertices[i][1],z=data.vertices[i][2];
            verts.push(x,y,z);

            if(renderMode==="wireframe"){
              cols.push(wireframeColor[0],wireframeColor[1],wireframeColor[2],wireframeColor[3]);
            }else if(colorMode==="gradient"){
              let t=(y-minY)/rY;
              cols.push(0.9,0.1+t*0.7,0.1,1);
            }else{
              cols.push(solidColor[0],solidColor[1],solidColor[2],solidColor[3]);
            }
          }

          if(data.faces){
            for(let i=0;i<data.faces.length;i++){
              let v0=data.faces[i][0],v1=data.faces[i][1],v2=data.faces[i][2];
              idxT.push(v0,v1,v2);
              idxL.push(v0,v1,v1,v2,v2,v0);
            }
          }

          this.triangleCount=idxT.length;
          this.lineCount=idxL.length;
          this.vertexCount=data.vertices.length;

          this.meshVAO=gl.createVertexArray();
          gl.bindVertexArray(this.meshVAO);

          let vb=gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER,vb);
          gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(verts),gl.STATIC_DRAW);
          gl.enableVertexAttribArray(0);
          gl.vertexAttribPointer(0,3,gl.FLOAT,false,0,0);

          let cb=gl.createBuffer();
          gl.bindBuffer(gl.ARRAY_BUFFER,cb);
          gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(cols),gl.STATIC_DRAW);
          gl.enableVertexAttribArray(1);
          gl.vertexAttribPointer(1,4,gl.FLOAT,false,0,0);

          if(this.triangleCount>0){
            this.triangleBuffer=gl.createBuffer();
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.triangleBuffer);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(idxT),gl.STATIC_DRAW);
          }

          gl.bindVertexArray(null);
          gl.bindBuffer(gl.ARRAY_BUFFER,null);
          gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);

          if(this.lineCount>0){
            this.lineBuffer=gl.createBuffer();
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.lineBuffer);
            gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint32Array(idxL),gl.STATIC_DRAW);
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);
          }
        }

        dibuja(gl){
          gl.bindVertexArray(this.meshVAO);
          if(renderMode==="wireframe"&&this.lineCount>0){
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.lineBuffer);
            gl.drawElements(gl.LINES,this.lineCount,gl.UNSIGNED_INT,0);
          }else if(this.triangleCount>0){
            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.triangleBuffer);
            gl.drawElements(gl.TRIANGLES,this.triangleCount,gl.UNSIGNED_INT,0);
          }
          gl.bindVertexArray(null);
        }
      }

      function compilaEnlazaLosShaders(){
        let vs=gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vs,document.getElementById("vs").text.trim());
        gl.compileShader(vs);
        if(!gl.getShaderParameter(vs,gl.COMPILE_STATUS))console.error(gl.getShaderInfoLog(vs));

        let fs=gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fs,document.getElementById("fs").text.trim());
        gl.compileShader(fs);
        if(!gl.getShaderParameter(fs,gl.COMPILE_STATUS))console.error(gl.getShaderInfoLog(fs));

        programaID=gl.createProgram();
        gl.attachShader(programaID,vs);
        gl.attachShader(programaID,fs);
        gl.linkProgram(programaID);
        if(!gl.getProgramParameter(programaID,gl.LINK_STATUS))console.error(gl.getProgramInfoLog(programaID));
        gl.useProgram(programaID);
      }

      function mouseDown(e){
        let x=e.x||e.clientX,y=e.y||e.clientY;
        x-=canvas.offsetLeft;
        y-=canvas.offsetTop;
        if(e.button==0){
          B=MatrizRotacion.slice();
          arcBall.primerPunto(x,y);
          boton_izq_presionado=true;
        }else if(e.button==2){
          boton_der_presionado=true;
        }
        return false;
      }

      function mouseUp(){
        boton_izq_presionado=false;
        boton_der_presionado=false;
      }

      function mouseMove(e){
        if(!boton_izq_presionado&&!boton_der_presionado)return;
        let x=e.x||e.clientX,y=e.y||e.clientY;
        x-=canvas.offsetLeft;
        y-=canvas.offsetTop;
        if(boton_izq_presionado){
          let q=arcBall.segundoPunto(x,y);
          Cuaternion.rota2(MatrizRotacion,q);
          multiplica(MatrizRotacion,MatrizRotacion,B);
        }else if(boton_der_presionado){
          tx=(x*10/canvas.width)-5;
          ty=(10-y*10/canvas.height)-5;
        }
      }

      function zoom(e){
        e.preventDefault();
        let f=e.deltaY>0?0.9:1.1;
        sx*=f;sy*=f;sz*=f;
      }

      function navegarArriba(){rotX-=10;}      // Rotar arriba (eje X)
      function navegarAbajo(){rotX+=10;}       // Rotar abajo (eje X)
      function navegarIzquierda(){rotY+=10;}   // Rotar izquierda (eje Y)
      function navegarDerecha(){rotY-=10;}     // Rotar derecha (eje Y)
      function acercarZoom(){sx*=1.1;sy*=1.1;sz*=1.1;}
      function alejarZoom(){sx*=0.9;sy*=0.9;sz*=0.9;}

      function dibuja(){
        if(!meshObject)return;
        gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);

        // Animaci√≥n autom√°tica
        if(animacionActiva) {
          rotY += VELOCIDAD_ROTACION;
        }

        identidad(MatrizModelo);
        traslacion(MatrizModelo,tx,ty,tz);
        rotacionX(MatrizModelo, rotX);
        rotacionY(MatrizModelo, rotY);
        rotacionZ(MatrizModelo, rotZ);
        escalacion(MatrizModelo,sx,sy,sz);
        escalacion(MatrizModelo,2,2,2);
        multiplica(MatrizModelo,MatrizModelo,MatrizRotacion);
        gl.uniformMatrix4fv(uMatrizModelo,false,MatrizModelo);
        meshObject.dibuja(gl);
        requestAnimationFrame(dibuja);
      }

      function reinicia(){
        tx=ty=tz=0;
        sx=sy=sz=1;
        rotX=rotY=rotZ=0;
        identidad(MatrizRotacion);
      }

      function cargarJSON(ruta){
        document.getElementById("info").textContent = "Cargando...";
        fetch(ruta)
          .then(r=>{if(!r.ok)throw new Error("Archivo no encontrado");return r.json();})
          .then(data=>{
            document.getElementById("info").textContent=
              data.vertices.length.toLocaleString()+" verts\n"+
              (data.faces?data.faces.length.toLocaleString()+" tris":"Sin faces");
            meshObject=new MeshFromJSON(gl,data);
            dibuja();
          })
          .catch(e=>{
            document.getElementById("info").textContent="Error: Archivo no encontrado\n\nAseg√∫rate de que los archivos:\n- red.json\n- megatronFinal.json\n- modelo3.json\nest√©n en la misma carpeta";
            console.error("Error cargando JSON:", e);
          });
      }

      function main(){
        canvas=document.getElementById("webglcanvas");
        gl=canvas.getContext("webgl2");
        if(!gl){document.write("WebGL 2.0 no disponible");return;}

        canvas.addEventListener("mousedown",mouseDown);
        canvas.addEventListener("mouseup",mouseUp);
        canvas.addEventListener("mouseout",mouseUp);
        canvas.addEventListener("mousemove",mouseMove);
        canvas.addEventListener("wheel",zoom,{passive:false});

        document.getElementById("upBtn").onclick=navegarArriba;
        document.getElementById("downBtn").onclick=navegarAbajo;
        document.getElementById("leftBtn").onclick=navegarIzquierda;
        document.getElementById("rightBtn").onclick=navegarDerecha;
        document.getElementById("homeBtn").onclick=reinicia;
        document.getElementById("zoomInBtn").onclick=acercarZoom;
        document.getElementById("zoomOutBtn").onclick=alejarZoom;

        document.getElementById("solidBtn").onclick=()=>{
          renderMode="solid";
          document.getElementById("solidBtn").classList.add("active");
          document.getElementById("wireframeBtn").classList.remove("active");
          cargarJSON(currentFile);
        };

        document.getElementById("wireframeBtn").onclick=()=>{
          renderMode="wireframe";
          document.getElementById("wireframeBtn").classList.add("active");
          document.getElementById("solidBtn").classList.remove("active");
          cargarJSON(currentFile);
        };

        document.getElementById("modelSelector").onchange=(e)=>{
          currentFile=e.target.value;
          cargarJSON(currentFile);
        };

        document.querySelectorAll(".color-btn").forEach(btn=>{
          btn.onclick=()=>{
            document.querySelectorAll(".color-btn").forEach(b=>b.classList.remove("active"));
            btn.classList.add("active");
            if(btn.dataset.mode){
              colorMode="gradient";
            }else{
              colorMode="solid";
              let hex=btn.dataset.color;
              solidColor=[
                parseInt(hex.substr(1,2),16)/255,
                parseInt(hex.substr(3,2),16)/255,
                parseInt(hex.substr(5,2),16)/255,
                1
              ];
            }
            cargarJSON(currentFile);
          };
        });

        // Checkbox de animaci√≥n
        document.getElementById("animacionCheckbox").onchange=(e)=>{
          animacionActiva = e.target.checked;
        };

        gl.viewport(0,0,canvas.width,canvas.height);
        compilaEnlazaLosShaders();
        arcBall=new ArcBall(canvas.width,canvas.height);

        uMatrizProyeccion=gl.getUniformLocation(programaID,"uMatrizProyeccion");
        uMatrizVista=gl.getUniformLocation(programaID,"uMatrizVista");
        uMatrizModelo=gl.getUniformLocation(programaID,"uMatrizModelo");

        //ortho(MatrizProyeccion,-5,5,-5,5,-5,5);

        //esta parte ha sido modificada para ajustar la proyecci√≥n ortogr√°fica al aspect ratio del canvas
        ortho(MatrizProyeccion, -5 * gl.canvas.width/gl.canvas.height,  5 * gl.canvas.width/gl.canvas.height, -5, 5, -5, 5);
        gl.uniformMatrix4fv(uMatrizProyeccion,false,MatrizProyeccion);
        identidad(MatrizVista);
        gl.uniformMatrix4fv(uMatrizVista,false,MatrizVista);
        identidad(MatrizRotacion);

        gl.enable(gl.DEPTH_TEST);
        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        //gl.lineWidth(1.5);

        cargarJSON(currentFile);
      }

      window.onload=main;
    </script>
  </body>
</html>
